% Alt. title: R E S U L T S
% The idea is that you have used the software to solve many problems
% and you're presenting the results...
%
% 1. Heat equation
% 2. BSE with different solvers (say you got the same solutions)
% 3. Speed-up with GPU solver
%      L  Dolan-Mor√© plot
% 4. Geom. Br. Motion results (plots)

\section{Heat Equation}\label{sec:heat_equation-results}
For the heat equation, we define the parameters as follows: \textbf{(Length of domain $L$ = 1, Spatial nodes = 100, Time = 30, Time Nodes = 10000, and Thermal Diffusivity $\kappa$ = 0.01)} It is further combined with the initial condition $u_0(x) = \sin(\pi x) + 5$, with time-dependent boundary conditions: $u(0,t) = 5 \sin\left(\frac{2 \pi}{25} t \right) + 5$ and $u(L,t) = t+5$.

\begin{figure}[H]
    \centering
    \begin{subfigure}[t]{0.45\textwidth}
        \centering
        \includegraphics[width=\textwidth]{figures/heat_explicit.pdf}
        \caption{\textbf{Explicit:} 3D Surface Plot for Heat Equation}
        \label{fig:heat-explicit-3d}
    \end{subfigure}
    \hfill
    \begin{subfigure}[t]{0.45\textwidth}
        \centering
        \includegraphics[width=\textwidth]{figures/heat_cn.pdf}
        \caption{\textbf{Crank-Nicolson:} 3D Surface Plot for Heat Equation}
        \label{fig:heat-cn-3d}
    \end{subfigure}
\end{figure}

Figures \ref{fig:heat-explicit-3d} and \ref{fig:heat-cn-3d} visualise the numerical solutions to the defined heat equation using the \textit{explicit} and \textit{Crank-Nicolson} methods respectively. The left boundary introduces a periodic boundary condition which manifests as oscillations observed in both plots at $x=0$. Meanwhile, the right boundary condition leads to a linear increase in temperature over time, as reflected in the steadily rising temperature at $x=1$. Under unfavourable conditions, the explicit method can lead to numerical instability shown in Figure \ref{fig:heat-explicit-unstable}

\begin{figure}[H]
    \centering
    \includegraphics[width=0.5\textwidth]{figures/heat_explicit_unstable.pdf}
    \caption{\textbf{Explicit:} 3D Surface Plot for Heat Equation (s\_nodes = 100, t\_nodes = 100)}
    \label{fig:heat-explicit-unstable}
\end{figure}

\section{Black-Scholes Equation}\label{sec:bs_equation-results}
Defining a common set of parameters for the Black-Scholes equation, the implemented solvers (\textit{numerical methods}) are tested against each other to verify their accuracy. The parameters used for the tests are as follows:
\textbf{(Initial Stock Price $S_0 = 300$, Strike Price $K = 100$, Risk-free Rate $r = 0.05$, Volatility $\sigma = 0.2$, Expiry $T = 1$, Spatial Nodes $= 100$, and Time Steps $= 1000$)}

\begin{figure}[H]
    \centering
    \begin{subfigure}[t]{0.45\textwidth}
        \centering
        \includegraphics[width=\textwidth]{figures/call_option_explicit.pdf}
        \caption{\textbf{Explicit:} 3D Surface Plot for Call Option}
        \label{fig:bs-explicit-call}
    \end{subfigure}
    \hfill
    \begin{subfigure}[t]{0.45\textwidth}
        \centering
        \includegraphics[width=\textwidth]{figures/call_option_cn.pdf}
        \caption{\textbf{Crank-Nicolson:} 3D Surface Plot for Call Option}
        \label{fig:bs-cn-call}
    \end{subfigure}
    \hfill
    \begin{subfigure}[t]{0.45\textwidth}
        \centering
        \includegraphics[width=\textwidth]{figures/put_option_explicit.pdf}
        \caption{\textbf{Explicit:} 3D Surface Plot for Put Option}
        \label{fig:bs-explicit-put}
    \end{subfigure}
    \hfill
    \begin{subfigure}[t]{0.45\textwidth}
        \centering
        \includegraphics[width=\textwidth]{figures/put_option_cn.pdf}
        \caption{\textbf{Crank-Nicolson:} 3D Surface Plot for Put Option}
        \label{fig:bs-cn-put}
    \end{subfigure}
\end{figure}

At a glance, the results of the numerical solvers appear to be displaying similar plots, staying consistent with theoretical expectations. The surface plots for both option types exhibits the expected behaviour, where call option prices stay close to zero when the underlying asset price is significantly below the strike price, particularly as time approaches maturity. The reverse occurs for a put option where the prices are close to zero when the underlying asset price is significantly above the strike price. Only when the underlying asset price is higher than the strike price, the call option prices begin to increase, and vice versa for the put option.

Like in figure \ref{fig:heat-explicit-unstable}, the explicit method for the Black-Scholes method can also lead to numerical instability if the time and spatial nodes are not appropriately chosen (shown in Figure).

\begin{figure}[H]
    \centering
    \includegraphics[width=0.5\textwidth]{figures/ bse_unstable.pdf}
    \caption{\textbf{Explicit:} 3D Surface Plot for Black-Scholes Equation (s\_nodes = 100, t\_nodes = 100)}
    \label{fig:bse-explicit-unstable}
\end{figure}

% At time $t=0$ (i.e. at the initial time step), the option price show a slight curvature before increasing, which is expected as it takes into account the dis

% \begin{figure}[H]
%     \centering
%     \begin{subfigure}[t]{0.45\textwidth}
%         \centering
%         \includegraphics[width=\textwidth]{figures/put_option_explicit.pdf}
%         \caption{\textbf{Explicit:} 3D Surface Plot for Put Option}
%         \label{fig:bs-explicit-put}
%     \end{subfigure}
%     \hfill
%     \begin{subfigure}[t]{0.45\textwidth}
%         \centering
%         \includegraphics[width=\textwidth]{figures/put_option_cn.pdf}
%         \caption{\textbf{Crank-Nicolson:} 3D Surface Plot for Put Option}
%         \label{fig:bs-cn-put}
%     \end{subfigure}
% \end{figure}


\section{GPU Speed-up Analysis}\label{sec:speedup_analysis}
The speed-up achieved by the GPU implementations of the numerical methods was evaluated by comparing their execution times to their corresponding CPU counterparts. The formula for speed-up is given by:
\begin{equation}
    \text{Speedup} = \frac{\text{CPU Execution Time}}{\text{GPU Execution Time}}
\end{equation}
\begin{figure}[H]
    \centering
    \begin{tikzpicture}
        \begin{loglogaxis}[
            xlabel={Spatial Nodes},
            ylabel={Speedup},
            title={Log-Log Plot of Speedup vs s nodes},
            grid=both,
            mark size=2pt,
            legend style={
                at={(1.05,1)},
                anchor=north west
            },
        ]
        \addplot[
            color=blue,
            mark=*,
        ]
        table[
            x={s nodes},
            y={Speedup},
            col sep=comma
        ] {csv/bse_cn_large_params.csv};
        \addlegendentry{Crank-Nicolson}

        \addplot[
            color=purple,
            mark=square*,
        ]
        table[
            x={s nodes},
            y={Speedup},
            col sep=comma
        ] {csv/bse_explicit_large_params.csv};
        \addlegendentry{Explicit}

        \end{loglogaxis}
    \end{tikzpicture}
    \caption{Speedup vs Spatial Nodes}
    \label{fig:speedup-bse}
\end{figure}

Figure \ref{fig:speedup-bse} presents a log-log plot of speed-up against an increasing number of spatial nodes for the Crank-Nicolson and Explicit methods. The results align with expectations, demonstrating a notable performance speedup with the GPU implementation, especially for larger problem sizes. With smaller problem sizes, particularly with the Crank-Nicolson method, the GPU implementation did not yield substantial speed-up where, in some cases, performed slower than the CPU. This is likely due to the GPU being underutilised for smaller cases, where its parallel processing capabilities are not fully leveraged. The plots demonstrate that there is a gradual increase in speed-up initially. However, as the problem size increases, the plot becomes steeper, indicating that the GPU is being utilised more effectively.

Looking at the results, the explicit method shows a higher speed-up compared to the Crank-Nicolson method, which is expected due to its lower computational complexity. The latter method requires a more complex solution process that involves solving a system of linear equations per time step, which can be more computationally intensive.
\section{Geometric Brownian Motion}\label{sec:gbm_results}

\begin{figure}[H]
    \centering
    \includegraphics[width=0.8\textwidth]{figures/monte_carlo_price_distribution.pdf}
    \caption{Distribution of prices at expiration}
    \label{fig:price-distribution}
\end{figure}

\section{Comparison of Numerical Methods}\label{sec:comparison_numerical_methods}

